<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å¤šç›´æ’­è§€çœ‹å·¥å…· Made by Okowa</title>

<style>
/* ===== å…¨åŸŸ ===== */
html, body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #eee;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial;
  overflow-y: scroll;
  scrollbar-width: none;
}
html::-webkit-scrollbar,
body::-webkit-scrollbar {
  display: none;
}

/* ===== å®¹å™¨ ===== */
#allStreamsContainer {
  max-width: 1600px;
  margin: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.row {
  display: grid;
  gap: 10px;
}

#topRow {
  grid-template-columns: repeat(2, 1fr);
}

#bottomRow {
  grid-template-columns: repeat(4, 1fr);
}

/* ===== æ’­æ”¾å™¨ ===== */
.stream-wrapper {
  position: relative;
  background: #2c2c2c;
  border-radius: 10px;
  overflow: hidden;
  aspect-ratio: 16 / 9;
}

.stream-wrapper iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: none;
}

/* ===== ç©ºæ ¼ ===== */
.add-button {
  position: absolute;
  inset: 0;
  background: none;
  border: 2px dashed #666;
  color: #aaa;
  font-size: 32px;
  cursor: pointer;
}
.add-button:hover {
  border-color: #fff;
  color: #fff;
}

/* ===== æ§åˆ¶ ===== */
.control {
  position: absolute;
  top: 6px;
  padding: 4px 6px;
  font-size: 13px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  z-index: 5;
}

.close-btn { right: 6px; background: #ff5555; color: #fff; }
.chat-btn  { right: 42px; background: #444; color: #fff; }
.split-btn { left: 6px; background: #444; color: #fff; }

/* ===== å››åˆ†å‰² ===== */
.quad {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 6px;
}

/* ===== èŠå¤©å®¤ ===== */
.chat-popup {
  position: fixed;
  top: 80px;
  right: 20px;
  width: 380px;
  height: 600px;
  background: rgba(20,20,20,.96);
  border: 1px solid #555;
  border-radius: 10px;
  z-index: 999;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(0,0,0,.6);
}

.chat-popup iframe {
  flex: 1;
  border: none;
}

.chat-close {
  align-self: flex-end;
  margin: 6px;
  padding: 4px 10px;
  background: #ff5555;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* ===== ç›´å‘ ===== */
@media (orientation: portrait) {
  #topRow {
    grid-template-columns: 1fr;
  }
  #bottomRow {
    grid-template-columns: repeat(2, 1fr);
  }
}
</style>
</head>

<body>

<div id="allStreamsContainer">
  <div id="topRow" class="row"></div>
  <div id="bottomRow" class="row"></div>
</div>

<script>
const STORAGE_KEY = 'multiLive_final_v1';
const topRow = document.getElementById('topRow');
const bottomRow = document.getElementById('bottomRow');

let layout = { top: 2, bottom: 4 };
let slots = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

/* ===== å„²å­˜ ===== */
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(slots));
}

/* ===== ç‰ˆé¢åˆ‡æ› ===== */
function updateLayout() {
  const portrait = window.matchMedia('(orientation: portrait)').matches;
  layout = portrait ? { top: 2, bottom: 8 } : { top: 2, bottom: 4 };
  buildUI();
}

/* ===== UI ===== */
function buildUI() {
  topRow.innerHTML = '';
  bottomRow.innerHTML = '';

  const total = layout.top + layout.bottom;
  while (slots.length < total) slots.push(null);

  for (let i = 0; i < layout.top; i++) {
    topRow.appendChild(renderSlot(i));
  }
  for (let i = layout.top; i < total; i++) {
    bottomRow.appendChild(renderSlot(i));
  }
}

/* ===== Slot ===== */
function renderSlot(index) {
  const data = slots[index];
  const box = document.createElement('div');
  box.className = 'stream-wrapper';

  if (!data) {
    const add = document.createElement('button');
    add.className = 'add-button';
    add.textContent = '+';
    add.onclick = () => inputVideo(index);
    box.appendChild(add);
    return box;
  }

  if (data.mode === 'single') {
    addIframe(box, data.videos[0]);
    addControls(box, index, true);
  } else {
    box.classList.add('quad');
    data.videos.forEach(v => {
      const cell = document.createElement('div');
      cell.className = 'stream-wrapper';
      addIframe(cell, v);
      box.appendChild(cell);
    });
    addControls(box, index, false);
  }
  return box;
}

/* ===== Iframe ===== */
function addIframe(box, id) {
  const iframe = document.createElement('iframe');
  iframe.src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1`;
  iframe.allow = 'autoplay';
  box.appendChild(iframe);
}

/* ===== æ§åˆ¶ ===== */
function addControls(box, index, canSplit) {
  const close = document.createElement('button');
  close.className = 'control close-btn';
  close.textContent = 'âœ•';
  close.onclick = () => {
    slots[index] = null;
    save();
    buildUI();
  };
  box.appendChild(close);

  const chat = document.createElement('button');
  chat.className = 'control chat-btn';
  chat.textContent = 'ğŸ’¬';
  chat.onclick = () => openChat(slots[index].videos[0]);
  box.appendChild(chat);

  if (canSplit) {
    const split = document.createElement('button');
    split.className = 'control split-btn';
    split.textContent = 'â§‰';
    split.onclick = () => {
      const id = slots[index].videos[0];
      slots[index] = { mode: 'quad', videos: [id, id, id, id] };
      save();
      buildUI();
    };
    box.appendChild(split);
  }
}

/* ===== è¼¸å…¥ ===== */
function inputVideo(index) {
  const url = prompt('è¼¸å…¥ YouTube ç›´æ’­ / å½±ç‰‡ç¶²å€');
  if (!url) return;
  const id = extractID(url);
  if (!id) return alert('ç„¡æ³•è§£æ YouTube é€£çµ');
  slots[index] = { mode: 'single', videos: [id] };
  save();
  buildUI();
}

/* ===== ID ===== */
function extractID(url) {
  const m = url.match(/(?:v=|youtu\.be\/|live\/)([a-zA-Z0-9_-]{11})/);
  return m ? m[1] : null;
}

/* ===== èŠå¤©å®¤ ===== */
function openChat(videoId) {
  const old = document.querySelector('.chat-popup');
  if (old) old.remove();

  const popup = document.createElement('div');
  popup.className = 'chat-popup';
  popup.innerHTML = `
    <button class="chat-close">âœ•</button>
    <iframe src="https://www.youtube.com/live_chat?v=${videoId}&embed_domain=${location.hostname}"></iframe>
  `;
  document.body.appendChild(popup);

  const close = popup.querySelector('.chat-close');
  const remove = () => popup.remove();
  close.onclick = remove;

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') remove();
  }, { once: true });
}

/* ===== å•Ÿå‹• ===== */
window.addEventListener('resize', updateLayout);
window.onload = updateLayout;
</script>

</body>
</html>
